<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Road A Institute - Mathematics, Science & Music Tuition</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f0f4f8 0%, #d9e2ec 100%); /* Light gradient background */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        /* Custom styles for smooth page transitions */
        #content-area {
            transition: background-color 0.8s ease-in-out, transform 0.8s ease-in-out;
            transform-origin: center center;
            /* Adjusted min-height to account for potentially taller header on mobile */
            min-height: calc(100vh - 120px - 128px); /* Header height (approx 120px) + Footer height (128px) */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }
        .page-enter-active {
            animation: fadeInScale 0.8s ease-out;
        }
        .page-exit-active {
            animation: fadeOutScale 0.8s ease-in;
        }
        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        @keyframes fadeOutScale {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0; transform: scale(0.95); }
        }

        /* Specific background colors for pages */
        .bg-home { background: linear-gradient(135deg, #a7f3d0 0%, #6ee7b7 100%); } /* Greenish */
        .bg-about { background: linear-gradient(135deg, #bfdbfe 0%, #93c5fd 100%); } /* Bluish */
        .bg-courses { background: linear-gradient(135deg, #fbcfe8 0%, #f472b6 100%); } /* Pinkish */
        .bg-contact { background: linear-gradient(135deg, #fed7aa 0%, #fbbf24 100%); } /* Orangish */
        .bg-enroll { background: linear-gradient(135deg, #d8b4fe 0%, #a78bfa 100%); } /* Purplish */
        .bg-payment { background: linear-gradient(135deg, #fecaca 0%, #ef4444 100%); } /* Reddish */
        .bg-chatbot { background: linear-gradient(135deg, #a5f3fc 0%, #22d3ee 100%); } /* Cyan */

        /* Navigation link active state */
        .nav-link.active {
            color: #1d4ed8; /* Darker blue for active link */
            font-weight: 600;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 9999px; /* Fully rounded */
        }
        .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        /* Custom scrollbar for chatbot */
        .chatbot-messages::-webkit-scrollbar {
            width: 8px;
        }
        .chatbot-messages::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .chatbot-messages::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        .chatbot-messages::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="font-inter bg-gray-100 min-h-screen flex flex-col">

    <!-- Header and Navigation -->
    <header class="bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg py-4 px-6 fixed w-full top-0 z-40">
        <div class="container mx-auto flex flex-col md:flex-row justify-between items-center">
            <h1 class="text-3xl font-bold mb-2 md:mb-0">Road A Institute</h1>
            <!-- Updated Navigation for better mobile responsiveness -->
            <nav>
                <ul class="flex flex-wrap justify-center text-base space-x-2 sm:space-x-4 md:space-x-6 md:text-lg">
                    <li><a href="#" class="nav-link px-2 py-1 rounded-full hover:bg-white hover:bg-opacity-20 transition-all duration-300 md:px-4 md:py-2" data-page="home">Home</a></li>
                    <li><a href="#" class="nav-link px-2 py-1 rounded-full hover:bg-white hover:bg-opacity-20 transition-all duration-300 md:px-4 md:py-2" data-page="about">About</a></li>
                    <li><a href="#" class="nav-link px-2 py-1 rounded-full hover:bg-white hover:bg-opacity-20 transition-all duration-300 md:px-4 md:py-2" data-page="courses">Courses</a></li>
                    <li><a href="#" class="nav-link px-2 py-1 rounded-full hover:bg-white hover:bg-opacity-20 transition-all duration-300 md:px-4 md:py-2" data-page="contact">Contact</a></li>
                    <li><a href="#" class="nav-link px-2 py-1 rounded-full hover:bg-white hover:bg-opacity-20 transition-all duration-300 md:px-4 md:py-2" data-page="enroll">Enroll Now</a></li>
                    <li><a href="#" class="nav-link px-2 py-1 rounded-full hover:bg-white hover:bg-opacity-20 transition-all duration-300 md:px-4 md:py-2" data-page="payment">Payments</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Content Area -->
    <!-- Adjusted mt-32 for mobile, mt-20 for medium and larger screens -->
    <main id="content-area" class="flex-grow p-4 md:p-8 relative overflow-hidden mt-32 md:mt-20">
        <!-- Page content will be loaded here dynamically -->
    </main>

    <!-- Footer -->
    <footer class="bg-gradient-to-r from-blue-700 to-purple-800 text-white py-8 mt-auto shadow-inner">
        <div class="container mx-auto flex flex-col md:flex-row justify-between items-center text-center md:text-left">
            <div class="mb-4 md:mb-0 pl-4">
                <h3 class="text-2xl font-bold mb-2">Road A Institute</h3>
                <p class="text-sm">&copy; 2024 All rights reserved.</p>
            </div>
            <div class="flex flex-col md:flex-row items-center space-y-3 md:space-y-0 md:space-x-4 text-base md:text-lg pr-4">
                <a href="https://wa.me/94710325294" target="_blank" class="flex items-center flex-nowrap hover:text-blue-200 transition-colors duration-300">
                    <i class="fab fa-whatsapp text-2xl mr-2"></i> +94 71 032 5294
                </a>
                <a href="mailto:learnwithpavanperera@gmail.com" class="flex items-center flex-nowrap hover:text-blue-200 transition-colors duration-300">
                    <i class="fas fa-envelope text-2xl mr-2"></i> learnwithpavanperera@gmail.com
                </a>
                <a href="https://www.facebook.com/share/1DjKgbYyMp/" target="_blank" class="flex items-center flex-nowrap hover:text-blue-200 transition-colors duration-300">
                    <i class="fab fa-facebook-square text-2xl mr-2"></i> Facebook
                </a>
            </div>
        </div>
    </footer>

    <script>
        // IMPORTANT: Replace "YOUR_GEMINI_API_KEY_HERE" with your actual Gemini API key.
        // You can get one from Google AI Studio: https://aistudio.google.com/app/apikey
        // Be aware that embedding API keys directly in client-side code makes them publicly visible.
        const GEMINI_API_KEY = "AIzaSyDsQYMMIAbqkOJ73OAC5nsDBTWSdRk-uj4"; 
        console.log("Current Gemini API Key value:", GEMINI_API_KEY); // Log API key status for debugging

        // Store the current page and its background class
        let currentPage = 'home';
        let currentBgClass = 'bg-home';

        // Function to dynamically load page content
        function loadPage(pageName) {
            const contentArea = document.getElementById('content-area');
            let pageContent = '';
            let newBgClass = '';

            // Store the current page in localStorage
            localStorage.setItem('lastPage', pageName);

            // Remove previous background class and add new one for transition
            contentArea.classList.remove(currentBgClass);
            contentArea.classList.add('page-exit-active'); // Add exit animation class

            // Delay content update and new background application to allow exit animation
            setTimeout(() => {
                switch (pageName) {
                    case 'home':
                        pageContent = `
                            <div class="text-center text-gray-800 max-w-4xl mx-auto page-enter-active">
                                <h2 class="text-5xl md:text-6xl font-extrabold mb-6 text-blue-700 leading-tight">
                                    Unlock Your Potential <br> with Road A Institute
                                </h2>
                                <p class="text-xl md:text-2xl mb-8 text-gray-700">
                                    Expert Tuition in Mathematics, Science & Music for Grade 6-11 O/L Students.
                                </p>
                                <div class="flex flex-col md:flex-row justify-center items-center space-y-4 md:space-y-0 md:space-x-6 mb-12">
                                    <button class="bg-blue-600 text-white px-8 py-4 rounded-full text-xl font-semibold shadow-lg hover:bg-blue-700 transition-all duration-300 transform hover:scale-105" onclick="loadPage('enroll')">
                                        <i class="fas fa-user-plus mr-3"></i> Join a Class
                                    </button>
                                    <button class="bg-purple-600 text-white px-8 py-4 rounded-full text-xl font-semibold shadow-lg hover:bg-purple-700 transition-all duration-300 transform hover:scale-105" onclick="loadPage('courses')">
                                        <i class="fas fa-book-open mr-3"></i> Explore Courses
                                    </button>
                                </div>

                                <!-- Our Teaching Methodology -->
                                <div class="bg-white p-8 rounded-2xl shadow-xl border border-gray-200 mt-12 w-full">
                                    <h3 class="text-4xl font-bold text-center text-blue-700 mb-8">Our Teaching Methodology</h3>
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                                        <div class="bg-gradient-to-br from-green-100 to-green-200 p-6 rounded-xl shadow-md transform hover:scale-105 transition-transform duration-300">
                                            <div class="text-5xl text-green-600 mb-4"><i class="fas fa-clipboard-list"></i></div>
                                            <h4 class="text-2xl font-bold text-green-800 mb-2">Comprehensive Practice</h4>
                                            <p class="text-gray-700">Master concepts through extensive past papers, unit papers, and challenging speed tests.</p>
                                        </div>
                                        <div class="bg-gradient-to-br from-yellow-100 to-yellow-200 p-6 rounded-xl shadow-md transform hover:scale-105 transition-transform duration-300">
                                            <div class="text-5xl text-yellow-600 mb-4"><i class="fas fa-flask"></i></div>
                                            <h4 class="text-2xl font-bold text-yellow-800 mb-2">Hands-on Learning</h4>
                                            <p class="text-gray-700">Engage with practicals and real-world applications to solidify understanding.</p>
                                        </div>
                                        <div class="bg-gradient-to-br from-red-100 to-red-200 p-6 rounded-xl shadow-md transform hover:scale-105 transition-transform duration-300">
                                            <div class="text-5xl text-red-600 mb-4"><i class="fas fa-lightbulb"></i></div>
                                            <h4 class="text-2xl font-bold text-red-800 mb-2">Deep Theoretical Grasp</h4>
                                            <p class="text-gray-700">Thorough explanations of theories and lessons ensure a strong foundational knowledge.</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Study Tip Section -->
                                <div class="bg-white p-8 rounded-2xl shadow-xl border border-gray-200 mt-12 w-full max-w-2xl mx-auto">
                                    <h3 class="text-4xl font-bold text-center text-blue-700 mb-8">Daily Study Tip</h3>
                                    <p id="study-tip-display" class="text-lg text-gray-700 mb-6 italic">Click the button below to get a new study tip!</p>
                                    <button class="bg-pink-600 text-white px-8 py-4 rounded-full text-xl font-semibold shadow-lg hover:bg-pink-700 transition-all duration-300 transform hover:scale-105" onclick="generateStudyTip()">
                                        Get a Study Tip ✨
                                    </button>
                                    <div id="study-tip-loading" class="text-center text-sm text-gray-500 mt-2 hidden">
                                        <i class="fas fa-spinner fa-spin mr-2"></i> Generating...
                                    </div>
                                </div>

                                <!-- New: Motivational Message Generator -->
                                <div class="bg-white p-8 rounded-2xl shadow-xl border border-gray-200 mt-12 w-full max-w-2xl mx-auto">
                                    <h3 class="text-4xl font-bold text-center text-blue-700 mb-8">Motivational Message ✨</h3>
                                    <input type="text" id="motivation-goal" placeholder="e.g., passing my O/Ls, improving my grades" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 mb-6">
                                    <button class="bg-orange-600 text-white px-8 py-4 rounded-full text-xl font-semibold shadow-lg hover:bg-orange-700 transition-all duration-300 transform hover:scale-105 w-full" onclick="generateMotivationalMessage()">
                                        Generate Message
                                    </button>
                                    <div id="motivation-display" class="mt-6 text-lg text-gray-700 italic"></div>
                                    <div id="motivation-loading" class="text-center text-sm text-gray-500 mt-2 hidden">
                                        <i class="fas fa-spinner fa-spin mr-2"></i> Generating...
                                    </div>
                                </div>
                            </div>
                        `;
                        newBgClass = 'bg-home';
                        break;
                    case 'about':
                        pageContent = `
                            <div class="text-center text-gray-800 max-w-5xl mx-auto page-enter-active">
                                <h2 class="text-5xl md:text-6xl font-extrabold mb-12 text-blue-700">About Road A Institute</h2>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
                                    <div class="bg-gradient-to-br from-blue-100 to-blue-200 p-8 rounded-2xl shadow-xl border border-blue-300 transform hover:scale-105 transition-transform duration-300">
                                        <div class="text-6xl text-blue-600 mb-6"><i class="fas fa-users"></i></div>
                                        <h3 class="text-4xl font-bold text-blue-800 mb-4">Our Story</h3>
                                        <p class="text-lg text-gray-700 leading-relaxed">
                                            Road A Institute is a dedicated tuition center coordinated by myself, <strong class="font-semibold">Pavan Malindu Perera</strong>, a Marine Engineer and a Music Visharad degree holder, alongside the invaluable support of <strong class="font-semibold">Mrs. Himaya</strong>. We are committed to nurturing young minds from Grade 6 to 11 O/L, providing a holistic learning experience.
                                        </p>
                                    </div>
                                    <div class="bg-gradient-to-br from-purple-100 to-purple-200 p-8 rounded-2xl shadow-xl border border-purple-300 transform hover:scale-105 transition-transform duration-300">
                                        <div class="text-6xl text-purple-600 mb-6"><i class="fas fa-heartbeat"></i></div>
                                        <h3 class="text-4xl font-bold text-purple-800 mb-4">Our Passion</h3>
                                        <p class="text-lg text-gray-700 leading-relaxed">
                                            Our passion lies in empowering students to excel. We achieve this through rigorous practice with past papers, challenging unit papers, stimulating speed tests, hands-on practicals, in-depth theories, and comprehensive lesson coverage. Every session is designed to build confidence and ensure mastery.
                                        </p>
                                    </div>
                                </div>

                                <div class="bg-white p-8 rounded-2xl shadow-xl border border-gray-200 mt-12 w-full max-w-2xl mx-auto">
                                    <h3 class="text-3xl font-bold text-center text-blue-700 mb-6">Our Commitment</h3>
                                    <p class="text-lg text-gray-700 leading-relaxed">
                                        We believe in creating a supportive and engaging environment where every student can thrive. Our personalized approach ensures that individual learning needs are met, fostering a deep understanding and love for Mathematics, Science, and Music.
                                    </p>
                                </div>
                            </div>
                        `;
                        newBgClass = 'bg-about';
                        break;
                    case 'courses':
                        pageContent = `
                            <div class="text-center text-gray-800 max-w-4xl mx-auto page-enter-active">
                                <h2 class="text-5xl md:text-6xl font-extrabold mb-12 text-blue-700">Our Diverse Courses</h2>

                                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                                    <div class="bg-gradient-to-br from-green-100 to-green-200 p-8 rounded-2xl shadow-xl border border-green-300 transform hover:scale-105 transition-transform duration-300">
                                        <div class="text-6xl text-green-600 mb-6"><i class="fas fa-calculator"></i></div>
                                        <h3 class="text-3xl font-bold text-green-800 mb-4">Mathematics</h3>
                                        <p class="text-lg text-gray-700 leading-relaxed">
                                            From foundational concepts to advanced problem-solving, our Math classes make complex topics simple and engaging for all O/L students.
                                        </p>
                                        <button class="mt-4 bg-blue-500 text-white px-4 py-2 rounded-full text-sm font-semibold hover:bg-blue-600 transition-colors duration-300" onclick="generateCourseDetails('Mathematics')">
                                            Generate More Details ✨
                                        </button>
                                        <div id="details-mathematics" class="mt-3 text-sm text-gray-600"></div>
                                        <div id="loading-mathematics" class="text-center text-sm text-gray-500 mt-2 hidden">
                                            <i class="fas fa-spinner fa-spin mr-2"></i> Generating...
                                        </div>
                                    </div>
                                    <div class="bg-gradient-to-br from-red-100 to-red-200 p-8 rounded-2xl shadow-xl border border-red-300 transform hover:scale-105 transition-transform duration-300">
                                        <div class="text-6xl text-red-600 mb-6"><i class="fas fa-microscope"></i></div>
                                        <h3 class="text-3xl font-bold text-red-800 mb-4">Science</h3>
                                        <p class="text-lg text-gray-700 leading-relaxed">
                                            Explore the wonders of Science with practical experiments, clear theoretical explanations, and a focus on critical thinking.
                                        </p>
                                        <button class="mt-4 bg-blue-500 text-white px-4 py-2 rounded-full text-sm font-semibold hover:bg-blue-600 transition-colors duration-300" onclick="generateCourseDetails('Science')">
                                            Generate More Details ✨
                                        </button>
                                        <div id="details-science" class="mt-3 text-sm text-gray-600"></div>
                                        <div id="loading-science" class="text-center text-sm text-gray-500 mt-2 hidden">
                                            <i class="fas fa-spinner fa-spin mr-2"></i> Generating...
                                        </div>
                                    </div>
                                    <div class="bg-gradient-to-br from-yellow-100 to-yellow-200 p-8 rounded-2xl shadow-xl border border-yellow-300 transform hover:scale-105 transition-transform duration-300">
                                        <div class="text-6xl text-yellow-600 mb-6"><i class="fas fa-music"></i></div>
                                        <h3 class="text-3xl font-bold text-yellow-800 mb-4">Music</h3>
                                        <p class="text-lg text-gray-700 leading-relaxed">
                                            Unleash your musical talent! Our Music classes cover theory, practical skills, and appreciation for students of all levels.
                                        </p>
                                        <button class="mt-4 bg-blue-500 text-white px-4 py-2 rounded-full text-sm font-semibold hover:bg-blue-600 transition-colors duration-300" onclick="generateCourseDetails('Music')">
                                            Generate More Details ✨
                                        </button>
                                        <div id="details-music" class="mt-3 text-sm text-gray-600"></div>
                                        <div id="loading-music" class="text-center text-sm text-gray-500 mt-2 hidden">
                                            <i class="fas fa-spinner fa-spin mr-2"></i> Generating...
                                        </div>
                                    </div>
                                </div>

                                <!-- New: Practice Question Generator -->
                                <div class="bg-white p-8 rounded-2xl shadow-xl border border-gray-200 mt-12 w-full max-w-2xl mx-auto">
                                    <h3 class="text-4xl font-bold text-center text-blue-700 mb-8">Practice Question Generator ✨</h3>
                                    <div class="flex flex-col md:flex-row items-center justify-center space-y-4 md:space-y-0 md:space-x-4 mb-6">
                                        <select id="practice-subject" class="p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full md:w-1/2">
                                            <option value="">Select Subject</option>
                                            <option value="Mathematics">Mathematics</option>
                                            <option value="Science">Science</option>
                                        </select>
                                        <select id="practice-grade" class="p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full md:w-1/2">
                                            <option value="">Select Grade</option>
                                            <option value="6">Grade 6</option>
                                            <option value="7">Grade 7</option>
                                            <option value="8">Grade 8</option>
                                            <option value="9">Grade 9</option>
                                            <option value="10">Grade 10</option>
                                            <option value="11">Grade 11</option>
                                        </select>
                                    </div>
                                    <button class="bg-indigo-600 text-white px-8 py-4 rounded-full text-xl font-semibold shadow-lg hover:bg-indigo-700 transition-all duration-300 transform hover:scale-105 w-full" onclick="generatePracticeQuestion()">
                                        Generate Question
                                    </button>
                                    <div id="practice-question-display" class="mt-6 text-lg text-gray-700 italic"></div>
                                    <div id="practice-question-loading" class="text-center text-sm text-gray-500 mt-2 hidden">
                                        <i class="fas fa-spinner fa-spin mr-2"></i> Generating...
                                    </div>
                                </div>

                                <!-- New: Music Theory Explainer -->
                                <div class="bg-white p-8 rounded-2xl shadow-xl border border-gray-200 mt-12 w-full max-w-2xl mx-auto">
                                    <h3 class="text-4xl font-bold text-center text-blue-700 mb-8">Music Theory Explainer ✨</h3>
                                    <input type="text" id="music-theory-topic" placeholder="e.g., Major Scales, Chords, Rhythm" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 mb-6">
                                    <button class="bg-teal-600 text-white px-8 py-4 rounded-full text-xl font-semibold shadow-lg hover:bg-teal-700 transition-all duration-300 transform hover:scale-105 w-full" onclick="explainMusicTheory()">
                                        Explain Topic
                                    </button>
                                    <div id="music-theory-explanation" class="mt-6 text-lg text-gray-700 leading-relaxed"></div>
                                    <div id="music-theory-loading" class="text-center text-sm text-gray-500 mt-2 hidden">
                                        <i class="fas fa-spinner fa-spin mr-2"></i> Generating...
                                    </div>
                                </div>

                                <!-- New: Concept Clarifier -->
                                <div class="bg-white p-8 rounded-2xl shadow-xl border border-gray-200 mt-12 w-full max-w-2xl mx-auto">
                                    <h3 class="text-4xl font-bold text-center text-blue-700 mb-8">Concept Clarifier ✨</h3>
                                    <input type="text" id="concept-to-clarify" placeholder="e.g., Photosynthesis, Quadratic Equation" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 mb-6">
                                    <button class="bg-green-600 text-white px-8 py-4 rounded-full text-xl font-semibold shadow-lg hover:bg-green-700 transition-all duration-300 transform hover:scale-105 w-full" onclick="clarifyConcept()">
                                        Clarify Concept
                                    </button>
                                    <div id="concept-explanation" class="mt-6 text-lg text-gray-700 leading-relaxed"></div>
                                    <div id="concept-loading" class="text-center text-sm text-gray-500 mt-2 hidden">
                                        <i class="fas fa-spinner fa-spin mr-2"></i> Generating...
                                    </div>
                                </div>
                            </div>
                        `;
                        newBgClass = 'bg-courses';
                        break;
                    case 'contact':
                        pageContent = `
                            <div class="text-center text-gray-800 max-w-3xl mx-auto page-enter-active">
                                <h2 class="text-5xl md:text-6xl font-extrabold mb-12 text-blue-700">Get In Touch</h2>

                                <div class="bg-white p-8 rounded-2xl shadow-xl border border-gray-200 grid grid-cols-1 md:grid-cols-2 gap-8">
                                    <div class="flex flex-col items-center p-6 bg-gradient-to-br from-green-100 to-green-200 rounded-xl shadow-md transform hover:scale-105 transition-transform duration-300">
                                        <div class="text-6xl text-green-600 mb-4"><i class="fab fa-whatsapp"></i></div>
                                        <h3 class="text-2xl font-bold text-green-800 mb-2">WhatsApp</h3>
                                        <a href="https://wa.me/94710325294" target="_blank" class="text-blue-600 hover:underline text-base md:text-lg font-medium w-full flex justify-center">
                                            <span class="flex items-center flex-nowrap overflow-hidden text-ellipsis">
                                                <i class="fab fa-whatsapp text-2xl mr-2"></i> +94 71 032 5294
                                            </span>
                                        </a>
                                    </div>
                                    <div class="flex flex-col items-center p-6 bg-gradient-to-br from-red-100 to-red-200 rounded-xl shadow-md transform hover:scale-105 transition-transform duration-300">
                                        <div class="text-6xl text-red-600 mb-4"><i class="fas fa-envelope"></i></div>
                                        <h3 class="text-2xl font-bold text-red-800 mb-2">Email Address</h3>
                                        <a href="mailto:learnwithpavanperera@gmail.com" class="text-blue-600 hover:underline text-base md:text-lg font-medium w-full flex justify-center">
                                            <span class="flex items-center flex-nowrap overflow-hidden text-ellipsis">
                                                <i class="fas fa-envelope text-2xl mr-2"></i> learnwithpavanperera@gmail.com
                                            </span>
                                        </a>
                                    </div>
                                    <div class="flex flex-col items-center p-6 bg-gradient-to-br from-blue-100 to-blue-200 rounded-xl shadow-md transform hover:scale-105 transition-transform duration-300 col-span-1 md:col-span-2">
                                        <div class="text-6xl text-blue-600 mb-4"><i class="fab fa-facebook"></i></div>
                                        <h3 class="text-2xl font-bold text-blue-800 mb-2">Facebook Page</h3>
                                        <a href="https://www.facebook.com/share/1DjKgbYyMp/" target="_blank" class="text-blue-600 hover:underline text-base md:text-lg font-medium w-full flex justify-center">
                                            <span class="flex items-center flex-nowrap overflow-hidden text-ellipsis">
                                                <i class="fab fa-facebook-square text-2xl mr-2"></i> Facebook
                                            </span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        `;
                        newBgClass = 'bg-contact';
                        break;
                    case 'enroll':
                        pageContent = `
                            <div class="text-center text-gray-800 max-w-3xl mx-auto page-enter-active">
                                <h2 class="text-5xl md:text-6xl font-extrabold mb-12 text-purple-700">Enroll Now!</h2>
                                <p class="text-xl text-gray-700 mb-8">Fill out the form below to join our classes.</p>

                                <form id="enrollment-form" class="bg-white p-8 rounded-2xl shadow-xl border border-purple-300 text-left">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                            <label for="student-name" class="block text-lg font-medium text-gray-700 mb-2">Student Name:</label>
                                            <input type="text" id="student-name" name="studentName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500" required oninput="saveEnrollmentData(this)">
                                        </div>
                                        <div>
                                            <label for="student-age" class="block text-lg font-medium text-gray-700 mb-2">Age:</label>
                                            <select id="student-age" name="studentAge" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500" required onchange="saveEnrollmentData(this)">
                                                <option value="">Select Age</option>
                                                <!-- Age options will be populated by JS -->
                                            </select>
                                        </div>
                                        <div>
                                            <label for="student-grade" class="block text-lg font-medium text-gray-700 mb-2">Grade:</label>
                                            <select id="student-grade" name="studentGrade" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500" required onchange="saveEnrollmentData(this)">
                                                <option value="">Select Grade</option>
                                                <!-- Grade options will be populated by JS -->
                                            </select>
                                        </div>
                                        <div class="md:col-span-2">
                                            <label class="block text-lg font-medium text-gray-700 mb-2">Subject(s) Willing to Join:</label>
                                            <div class="flex flex-col space-y-2">
                                                <label class="inline-flex items-center">
                                                    <input type="checkbox" name="subjects" value="Mathematics" class="form-checkbox h-5 w-5 text-purple-600 rounded focus:ring-purple-500" onchange="handleSubjectChange(); saveEnrollmentData(this);">
                                                    <span class="ml-2 text-gray-700 text-lg">Mathematics</span>
                                                </label>
                                                <label class="inline-flex items-center">
                                                    <input type="checkbox" name="subjects" value="Science" class="form-checkbox h-5 w-5 text-purple-600 rounded focus:ring-purple-500" onchange="handleSubjectChange(); saveEnrollmentData(this);">
                                                    <span class="ml-2 text-gray-700 text-lg">Science</span>
                                                </label>
                                                <label class="inline-flex items-center">
                                                    <input type="checkbox" name="subjects" value="Music" class="form-checkbox h-5 w-5 text-purple-600 rounded focus:ring-purple-500" onchange="handleSubjectChange(); saveEnrollmentData(this);">
                                                    <span class="ml-2 text-gray-700 text-lg">Music</span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="md:col-span-2">
                                            <label for="parent-name" class="block text-lg font-medium text-gray-700 mb-2">Parent/Guardian Name:</label>
                                            <input type="text" id="parent-name" name="parentName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500" required oninput="saveEnrollmentData(this)">
                                        </div>
                                        <div class="md:col-span-2">
                                            <label for="home-address" class="block text-lg font-medium text-gray-700 mb-2">Home Address:</label>
                                            <textarea id="home-address" name="homeAddress" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500" required oninput="saveEnrollmentData(this)"></textarea>
                                        </div>
                                        <div class="md:col-span-2">
                                            <label for="contact-number" class="block text-lg font-medium text-gray-700 mb-2">Contact Number:</label>
                                            <input type="tel" id="contact-number" name="contactNumber" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500" pattern="[0-9]{10}" placeholder="e.g., 0712345678" required oninput="saveEnrollmentData(this)">
                                            <p class="text-sm text-gray-500 mt-1">Format: 10 digits (e.g., 0712345678)</p>
                                        </div>
                                    </div>
                                    <button type="submit" class="mt-8 w-full bg-purple-600 text-white px-8 py-4 rounded-full text-xl font-semibold shadow-lg hover:bg-purple-700 transition-all duration-300 transform hover:scale-105">
                                        <i class="fas fa-paper-plane mr-3"></i> Send Enrollment Request
                                    </button>
                                </form>
                            </div>
                        `;
                        newBgClass = 'bg-enroll';
                        break;
                    case 'payment':
                        pageContent = `
                            <div class="text-center text-gray-800 max-w-2xl mx-auto page-enter-active">
                                <h2 class="text-5xl md:text-6xl font-extrabold mb-12 text-red-700">Online Payments</h2>
                                <p class="text-xl text-gray-700 mb-8">Securely pay your class fees here.</p>

                                <form id="payment-form" class="bg-white p-8 rounded-2xl shadow-xl border border-red-300 text-left">
                                    <div class="space-y-6">
                                        <div>
                                            <label for="card-number" class="block text-lg font-medium text-gray-700 mb-2">Card Number:</label>
                                            <input type="text" id="card-number" name="cardNumber" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500" placeholder="e.g., 1234 5678 9012 3456" maxlength="19" required>
                                            <p class="text-sm text-gray-500 mt-1">Enter your 16-digit card number.</p>
                                        </div>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                            <div>
                                                <label for="expiry-date" class="block text-lg font-medium text-gray-700 mb-2">Expiry Date (MM/YY):</label>
                                                <input type="text" id="expiry-date" name="expiryDate" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500" placeholder="MM/YY" maxlength="5" required>
                                                <p class="text-sm text-gray-500 mt-1">Format: MM/YY</p>
                                            </div>
                                            <div>
                                                <label for="security-code" class="block text-lg font-medium text-gray-700 mb-2">Security Code (CVV):</label>
                                                <input type="text" id="security-code" name="securityCode" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500" pattern="[0-9]{3}" placeholder="e.g., 123" maxlength="3" required>
                                                <p class="text-sm text-gray-500 mt-1">3 digits</p>
                                            </div>
                                        </div>
                                    </div>
                                    <button type="submit" class="mt-8 w-full bg-red-600 text-white px-8 py-4 rounded-full text-xl font-semibold shadow-lg hover:bg-red-700 transition-all duration-300 transform hover:scale-105">
                                        <i class="fas fa-credit-card mr-3"></i> Make Payment
                                    </button>
                                
                                </form>

                                <div id="payment-success-message" class="hidden mt-6 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg relative" role="alert">
                                    <strong class="font-bold">Payment Simulated!</strong>
                                    <span class="block sm:inline"> Click below to send your receipt via WhatsApp.</span>
                                    <button id="send-receipt-whatsapp" class="mt-4 w-full bg-green-600 text-white px-6 py-3 rounded-full text-lg font-semibold shadow-lg hover:bg-green-700 transition-all duration-300 transform hover:scale-105">
                                        <i class="fab fa-whatsapp mr-3"></i> Send Receipt via WhatsApp
                                    </button>
                                </div>
                            </div>
                        `;
                        newBgClass = 'bg-payment';
                        break;
                    default:
                        pageContent = `<div class="text-center text-gray-800"><h2 class="text-4xl font-bold">Page Not Found</h2><p class="text-lg mt-4">The page you requested does not exist.</p></div>`;
                        newBgClass = 'bg-gray-100'; // Default fallback
                }

                contentArea.innerHTML = pageContent;
                contentArea.classList.remove('page-exit-active');
                contentArea.classList.add(newBgClass); // Add new background class
                contentArea.classList.add('page-enter-active'); // Add enter animation class

                // Update current page and background class
                currentPage = pageName;
                currentBgClass = newBgClass;

                // Re-attach event listeners for forms if they are on the new page
                if (pageName === 'enroll') {
                    document.getElementById('enrollment-form').addEventListener('submit', handleEnrollmentSubmit);
                    populateAgeAndGradeOptions(); // Populate dropdowns
                    // Attach change listeners to subject checkboxes for dynamic validation and saving
                    document.querySelectorAll('input[name="subjects"]').forEach(checkbox => {
                        checkbox.addEventListener('change', handleSubjectChange);
                        checkbox.addEventListener('change', () => saveEnrollmentData(checkbox)); // Add saving for checkboxes
                    });
                    loadEnrollmentData(); // Load saved data after elements are in DOM
                    handleSubjectChange(); // Initial call to set required status based on loaded data
                } else if (pageName === 'payment') {
                    document.getElementById('payment-form').addEventListener('submit', handlePaymentSubmit);
                    // Re-attach listener for WhatsApp receipt button as it's dynamically added
                    document.getElementById('send-receipt-whatsapp').addEventListener('click', handleSendReceiptWhatsApp);
                    
                    // Add specific input formatting for payment page
                    document.getElementById('card-number').addEventListener('input', formatCardNumber);
                    document.getElementById('expiry-date').addEventListener('input', formatExpiryDate);
                    // CVV already handled by maxlength and pattern attributes
                }

                // Update active navigation link
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                    if (link.dataset.page === pageName) {
                        link.classList.add('active');
                    }
                });

            }, 800); // Wait for exit animation to complete
        }

        // Function to format card number input
        function formatCardNumber(event) {
            let input = event.target.value.replace(/\D/g, ''); // Remove non-digits
            input = input.substring(0, 16); // Limit to 16 digits
            let formattedInput = '';
            for (let i = 0; i < input.length; i++) {
                if (i > 0 && i % 4 === 0) {
                    formattedInput += ' ';
                }
                formattedInput += input[i];
            }
            event.target.value = formattedInput;
        }

        // Function to format expiry date input
        function formatExpiryDate(event) {
            let input = event.target.value.replace(/\D/g, ''); // Remove non-digits
            if (input.length > 2) {
                input = input.substring(0, 2) + '/' + input.substring(2, 4); // Add slash and limit to 4 digits
            }
            event.target.value = input;
        }

        // Function to save enrollment form data to localStorage
        function saveEnrollmentData(element) {
            let formData = JSON.parse(localStorage.getItem('enrollmentFormData') || '{}');
            if (element.type === 'checkbox') {
                if (!formData.subjects) {
                    formData.subjects = [];
                }
                if (element.checked) {
                    if (!formData.subjects.includes(element.value)) {
                        formData.subjects.push(element.value);
                    }
                } else {
                    formData.subjects = formData.subjects.filter(sub => sub !== element.value);
                }
            } else {
                formData[element.name] = element.value;
            }
            localStorage.setItem('enrollmentFormData', JSON.stringify(formData));
        }

        // Function to load and pre-fill enrollment form data from localStorage
        function loadEnrollmentData() {
            const formData = JSON.parse(localStorage.getItem('enrollmentFormData') || '{}');
            const form = document.getElementById('enrollment-form');
            if (!form) return;

            for (const key in formData) {
                const element = form.elements[key];
                if (element) {
                    if (element.type === 'checkbox') {
                        if (Array.isArray(formData[key])) {
                            form.querySelectorAll(`input[name="${key}"]`).forEach(checkbox => {
                                checkbox.checked = formData[key].includes(checkbox.value);
                            });
                        }
                    } else {
                        element.value = formData[key];
                    }
                }
            }
        }

        // Function to populate age and grade dropdowns
        function populateAgeAndGradeOptions() {
            const ageSelect = document.getElementById('student-age');
            const gradeSelect = document.getElementById('student-grade');

            // Clear existing options except the first "Select Age/Grade"
            ageSelect.innerHTML = '<option value="">Select Age</option>';
            gradeSelect.innerHTML = '<option value="">Select Grade</option>';

            // Populate age options 10-16
            for (let i = 10; i <= 16; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                ageSelect.appendChild(option);
            }

            // Populate grade options 6-11
            for (let i = 6; i <= 11; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                gradeSelect.appendChild(option);
            }
        }

        // Function to handle subject checkbox changes and apply age/grade restrictions
        function handleSubjectChange() {
            const mathScienceCheckboxes = document.querySelectorAll('input[name="subjects"][value="Mathematics"], input[name="subjects"][value="Science"]');
            const musicCheckbox = document.querySelector('input[name="subjects"][value="Music"]');
            const ageSelect = document.getElementById('student-age');
            const gradeSelect = document.getElementById('student-grade');

            let isMathScienceSelected = false;
            mathScienceCheckboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    isMathScienceSelected = true;
                }
            });

            const isOnlyMusicSelected = musicCheckbox.checked && !isMathScienceSelected;

            if (isOnlyMusicSelected) {
                ageSelect.removeAttribute('required');
                gradeSelect.removeAttribute('required');
            } else {
                ageSelect.setAttribute('required', 'required');
                gradeSelect.setAttribute('required', 'required');
            }
        }


        // Handle Enrollment Form Submission
        function handleEnrollmentSubmit(event) {
            event.preventDefault(); // Prevent default form submission

            const form = event.target;
            const formData = new FormData(form);
            const data = {};
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }

            // Manually collect selected subjects from checkboxes
            const selectedSubjects = [];
            form.querySelectorAll('input[name="subjects"]:checked').forEach(checkbox => {
                selectedSubjects.push(checkbox.value);
            });
            data.subjects = selectedSubjects.join(', ') || 'No subjects selected'; // Handle case where none are selected

            const age = parseInt(data.studentAge);
            const grade = parseInt(data.studentGrade); 
            
            // Check if Mathematics or Science is selected for validation
            const isMathScienceSelected = selectedSubjects.includes('Mathematics') || selectedSubjects.includes('Science');

            if (isMathScienceSelected) {
                if (isNaN(age) || age < 10 || age > 16) {
                    showMessageBox("For Mathematics/Science, age must be between 10 and 16.");
                    return;
                }
                if (isNaN(grade) || grade < 6 || grade > 11) {
                    showMessageBox("For Mathematics/Science, grade must be between 6 and 11.");
                    return;
                }
            } else if (selectedSubjects.length === 0) {
                 showMessageBox("Please select at least one subject.");
                 return;
            }


            const message = `
*New Student Enrollment Request:*

*Student Details:*
Name: ${data.studentName}
Age: ${data.studentAge}
Grade: ${data.studentGrade}
Subject(s): ${data.subjects}

*Parent/Guardian Details:*
Name: ${data.parentName}
Contact: ${data.contactNumber}

*Home Address:*
${data.homeAddress}
            `.trim(); // Trim to remove leading/trailing whitespace

            // Open WhatsApp chat
            window.open(`https://wa.me/94710325294?text=${encodeURIComponent(message)}`, '_blank');

            // Clear form data from localStorage after successful submission
            localStorage.removeItem('enrollmentFormData');
            // Clear form
            form.reset();
            // Show a temporary success message
            const contentArea = document.getElementById('content-area');
            const successDiv = document.createElement('div');
            successDiv.className = 'mt-6 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg relative text-center';
            successDiv.innerHTML = '<strong class="font-bold">Enrollment Request Sent!</strong><span class="block sm:inline"> Please check WhatsApp to confirm.</span>';
            contentArea.appendChild(successDiv);
            setTimeout(() => successDiv.remove(), 5000); // Remove after 5 seconds
        }

        // Handle Payment Form Submission
        function handlePaymentSubmit(event) {
            event.preventDefault(); // Prevent default form submission

            const form = event.target;
            const cardNumber = form.elements['cardNumber'].value.replace(/\s/g, ''); // Remove spaces for validation
            const expiryDate = form.elements['expiryDate'].value;
            const securityCode = form.elements['securityCode'].value;

            // Basic validation (more robust validation would be needed for a real payment gateway)
            if (cardNumber.length !== 16 || isNaN(cardNumber)) {
                showMessageBox("Please enter a valid 16-digit card number.");
                return;
            }
            if (!/^(0[1-9]|1[0-2])\/[0-9]{2}$/.test(expiryDate)) {
                showMessageBox("Please enter a valid expiry date (MM/YY).");
                return;
            }
            if (!/^[0-9]{3}$/.test(securityCode)) { // Updated to exactly 3 digits
                showMessageBox("Please enter a valid 3-digit security code (CVV).");
                return;
            }

            // Simulate payment success
            document.getElementById('payment-success-message').classList.remove('hidden');
            form.reset(); // Clear form
            // Hide the payment form itself
            form.classList.add('hidden');
        }

        // Handle Send Receipt via WhatsApp
        function handleSendReceiptWhatsApp() {
            const message = `
*Payment Receipt - Road A Institute*

Dear Student/Parent,

Thank time for your payment to Road A Institute. Your transaction has been successfully processed.

We appreciate your trust in us!

Best Regards,
Road A Institute
            `.trim();

            window.open(`https://wa.me/94710325294?text=${encodeURIComponent(message)}`, '_blank');
        }

        // Custom Message Box Function (replaces alert())
        function showMessageBox(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity50 flex items-center justify-center z-[100] p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-xl shadow-2xl p-8 max-w-sm w-full text-center">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">Notification</h3>
                    <p class="text-gray-700 mb-6">${message}</p>
                    <button class="bg-blue-600 text-white px-6 py-3 rounded-full text-lg font-semibold hover:bg-blue-700 transition-colors duration-300" onclick="this.closest('.fixed').remove()">OK</button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Gemini API powered features
        async function generateCourseDetails(subject) {
            const displayDiv = document.getElementById(`details-${subject.toLowerCase()}`);
            const loadingDiv = document.getElementById(`loading-${subject.toLowerCase()}`);
            displayDiv.innerHTML = ''; // Clear previous content
            loadingDiv.classList.remove('hidden'); // Show loading

            if (!GEMINI_API_KEY || GEMINI_API_KEY === "YOUR_GEMINI_API_KEY_HERE") {
                displayDiv.innerHTML = "AI features are not configured. Please set your Gemini API key.";
                console.error("Gemini API Key is not set. Please replace 'YOUR_GEMINI_API_KEY_HERE' with your actual API key.");
                loadingDiv.classList.add('hidden');
                return;
            }

            // Reduced word count for faster response
            const prompt = `Generate a very concise paragraph (max 40 words) about what makes the ${subject} tuition class at Road A Institute unique and beneficial for Grade 6-11 O/L students.`;

            let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    displayDiv.innerHTML = result.candidates[0].content.parts[0].text;
                } else {
                    displayDiv.innerHTML = "Failed to generate details. Please try again.";
                    console.error("AI response structure unexpected:", result);
                }
            } catch (error) {
                console.error(`Error generating ${subject} details:`, error);
                displayDiv.innerHTML = "Error connecting to AI. Please try again.";
            } finally {
                loadingDiv.classList.add('hidden'); // Hide loading
            }
        }

        async function generateStudyTip() {
            const displayDiv = document.getElementById('study-tip-display');
            const loadingDiv = document.getElementById('study-tip-loading');
            displayDiv.innerHTML = ''; // Clear previous content
            loadingDiv.classList.remove('hidden'); // Show loading

            if (!GEMINI_API_KEY || GEMINI_API_KEY === "YOUR_GEMINI_API_KEY_HERE") {
                displayDiv.innerHTML = "AI features are not configured. Please set your Gemini API key.";
                console.error("Gemini API Key is not set. Please replace 'YOUR_GEMINI_API_KEY_HERE' with your actual API key.");
                loadingDiv.classList.add('hidden');
                return;
            }

            // Reduced word count for faster response
            const prompt = `Generate a very short, actionable study tip (max 30 words) for a Grade 6-11 O/L student in Sri Lanka. Make it encouraging.`;

            let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    displayDiv.innerHTML = result.candidates[0].content.parts[0].text;
                } else {
                    displayDiv.innerHTML = "Failed to generate tip. Please try again.";
                    console.error("AI response structure unexpected:", result);
                }
            } catch (error) {
                console.error("Error generating study tip:", error);
                displayDiv.innerHTML = "Error connecting to AI. Please try again.";
            } finally {
                loadingDiv.classList.add('hidden'); // Hide loading
            }
        }

        // New: Function to generate practice question
        async function generatePracticeQuestion() {
            const subject = document.getElementById('practice-subject').value;
            const grade = document.getElementById('practice-grade').value;
            const displayDiv = document.getElementById('practice-question-display');
            const loadingDiv = document.getElementById('practice-question-loading');
            displayDiv.innerHTML = ''; // Clear previous content
            loadingDiv.classList.remove('hidden'); // Show loading

            if (!subject || !grade) {
                displayDiv.innerHTML = "Please select both a subject and a grade.";
                loadingDiv.classList.add('hidden');
                return;
            }

            if (!GEMINI_API_KEY || GEMINI_API_KEY === "YOUR_GEMINI_API_KEY_HERE") {
                displayDiv.innerHTML = "AI features are not configured. Please set your Gemini API key.";
                console.error("Gemini API Key is not set. Please replace 'YOUR_GEMINI_API_KEY_HERE' with your actual API key.");
                loadingDiv.classList.add('hidden');
                return;
            }

            // Reduced word count for faster response
            const prompt = `Generate a very simple, single-line practice question (max 20 words) for a Grade ${grade} student in ${subject}. Do not include the answer.`;

            let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    displayDiv.innerHTML = result.candidates[0].content.parts[0].text;
                } else {
                    displayDiv.innerHTML = "Failed to generate question. Please try again.";
                    console.error("AI response structure unexpected:", result);
                }
            } catch (error) {
                console.error(`Error generating practice question for ${subject}, Grade ${grade}:`, error);
                displayDiv.innerHTML = "Error connecting to AI. Please try again.";
            } finally {
                loadingDiv.classList.add('hidden'); // Hide loading
            }
        }

        // New: Function to explain music theory
        async function explainMusicTheory() {
            const topic = document.getElementById('music-theory-topic').value.trim();
            const displayDiv = document.getElementById('music-theory-explanation');
            const loadingDiv = document.getElementById('music-theory-loading');
            displayDiv.innerHTML = ''; // Clear previous content
            loadingDiv.classList.remove('hidden'); // Show loading

            if (!topic) {
                displayDiv.innerHTML = "Please enter a music theory topic.";
                loadingDiv.classList.add('hidden');
                return;
            }

            if (!GEMINI_API_KEY || GEMINI_API_KEY === "YOUR_GEMINI_API_KEY_HERE") {
                displayDiv.innerHTML = "AI features are not configured. Please set your Gemini API key.";
                console.error("Gemini API Key is not set. Please replace 'YOUR_GEMINI_API_KEY_HERE' with your actual API key.");
                loadingDiv.classList.add('hidden');
                return;
            }

            // Reduced word count for faster response
            const prompt = `Explain the music theory concept "${topic}" in very simple terms, suitable for a beginner. Keep the explanation under 50 words.`;

            let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    displayDiv.innerHTML = result.candidates[0].content.parts[0].text;
                } else {
                    displayDiv.innerHTML = "Failed to explain topic. Please try again.";
                    console.error("AI response structure unexpected:", result);
                }
            } catch (error) {
                console.error(`Error explaining music theory topic "${topic}":`, error);
                displayDiv.innerHTML = "Error connecting to AI. Please try again.";
            } finally {
                loadingDiv.classList.add('hidden'); // Hide loading
            }
        }

        // New: Function to clarify general concepts
        async function clarifyConcept() {
            const concept = document.getElementById('concept-to-clarify').value.trim();
            const displayDiv = document.getElementById('concept-explanation');
            const loadingDiv = document.getElementById('concept-loading');
            displayDiv.innerHTML = ''; // Clear previous content
            loadingDiv.classList.remove('hidden'); // Show loading

            if (!concept) {
                displayDiv.innerHTML = "Please enter a concept to clarify.";
                loadingDiv.classList.add('hidden');
                return;
            }

            if (!GEMINI_API_KEY || GEMINI_API_KEY === "YOUR_GEMINI_API_KEY_HERE") {
                displayDiv.innerHTML = "AI features are not configured. Please set your Gemini API key.";
                console.error("Gemini API Key is not set. Please replace 'YOUR_GEMINI_API_KEY_HERE' with your actual API key.");
                loadingDiv.classList.add('hidden');
                return;
            }

            // Reduced word count for faster response
            const prompt = `Explain the concept "${concept}" in very simple terms, suitable for a Grade 6-11 O/L student. Keep the explanation under 50 words.`;

            let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    displayDiv.innerHTML = result.candidates[0].content.parts[0].text;
                } else {
                    displayDiv.innerHTML = "Failed to clarify concept. Please try again.";
                    console.error("AI response structure unexpected:", result);
                }
            } catch (error) {
                console.error(`Error clarifying concept "${concept}":`, error);
                displayDiv.innerHTML = "Error connecting to AI. Please try again.";
            } finally {
                loadingDiv.classList.add('hidden'); // Hide loading
            }
        }

        // New: Function to generate motivational message
        async function generateMotivationalMessage() {
            const goal = document.getElementById('motivation-goal').value.trim();
            const displayDiv = document.getElementById('motivation-display');
            const loadingDiv = document.getElementById('motivation-loading');
            displayDiv.innerHTML = ''; // Clear previous content
            loadingDiv.classList.remove('hidden'); // Show loading

            if (!GEMINI_API_KEY || GEMINI_API_KEY === "YOUR_GEMINI_API_KEY_HERE") {
                displayDiv.innerHTML = "AI features are not configured. Please set your Gemini API key.";
                console.error("Gemini API Key is not set. Please replace 'YOUR_GEMINI_API_KEY_HERE' with your actual API key.");
                loadingDiv.classList.add('hidden');
                return;
            }

            // Reduced word count for faster response
            let prompt = `Generate a very short, encouraging motivational message (max 30 words) for a student.`;
            if (goal) {
                prompt += ` The message should be tailored towards achieving the goal: "${goal}".`;
            } else {
                prompt += ` Make it general but inspiring for academic success.`;
            }

            let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    displayDiv.innerHTML = result.candidates[0].content.parts[0].text;
                } else {
                    displayDiv.innerHTML = "Failed to generate message. Please try again.";
                    console.error("AI response structure unexpected:", result);
                }
            } catch (error) {
                console.error("Error generating motivational message:", error);
                displayDiv.innerHTML = "Error connecting to AI. Please try again.";
            } finally {
                loadingDiv.classList.add('hidden'); // Hide loading
            }
        }

        // Initial page load and event listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Check localStorage for the last visited page
            const lastPage = localStorage.getItem('lastPage');
            if (lastPage) {
                loadPage(lastPage);
            } else {
                loadPage('home'); // Default to home if no last page is found
            }

            // Attach event listeners to navigation links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    loadPage(e.target.dataset.page);
                });
            });
        });
    </script>
    <!-- Tidio Chatbot Manual Installation Code -->
    <script src="//code.tidio.co/lmffuvqlili6uonb5clkyqnnethmekew.js" async></script>
</body>
</html>
